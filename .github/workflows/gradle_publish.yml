---
name: Gradle_Publish

on:
  workflow_call:
    inputs:
      ARTIFACTORY_URL:
        required: true
        type: string  # staging/snapshots/releases
    secrets:
      ARTIFACTORY_USER:
        required: true
      ARTIFACTORY_PASSWORD:
        required: true


jobs:
  build:
    strategy:
      matrix:
        java: [1.8]
        os: [ubuntu-latest]
    runs-on: ${{ matrix.os }}
    env:
      gradle_version: 6.8.3 # set to empty to build with most recent version of gradle
      gradle_commands: publish # default is build
    steps:
      - uses: actions/checkout@v2
      - name: Set up environment
        uses: ome/action-gradle@v1
        with:
          java-version: ${{ matrix.java }}
          gradle-version: ${{ env.gradle_version }}
      - name: Set ARTIFACTORY_URL
        run: |
          VAR=${{ inputs.ARTIFACTORY_URL }}
          if [ "$VAR" = "staging" ]; then
            echo "ARTIFACTORY_URL=https://artifacts.openmicroscopy.org/artifactory/ome.staging" >> $GITHUB_ENV
          elif [ "$VAR" = "releases" ]; then
            echo "ARTIFACTORY_URL=https://artifacts.openmicroscopy.org/artifactory/ome.releases" >> $GITHUB_ENV
          else
            echo "ARTIFACTORY_URL=https://artifacts.openmicroscopy.org/artifactory/ome.snapshots" >> $GITHUB_ENV
          fi
      - name: Run commands
        run: ./gradlew ${{ env.gradle_commands }}
        env:
          ARTIFACTORY_USER: ${{ secrets.ARTIFACTORY_USER }}
          ARTIFACTORY_PASSWORD: ${{ secrets.ARTIFACTORY_PASSWORD }}
